!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("redux-app",[],e):"object"==typeof exports?exports["redux-app"]=e():t["redux-app"]=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";function r(t,e,n){return t[e]=n}function o(t,e){return t[e]}function i(t){var e=Object.keys(t);return function(n,r){void 0===n&&(n={});for(var o=!1,i={},a=0,c=e;a<c.length;a++){var s=c[a],u=t[s],p=n[s],f=u(p,r);i[s]=f,o=o||f!==p}return o?i:n}}function a(t){for(var e=Object.keys(t),n=0,r=e;n<r.length;n++){delete t[r[n]]}}function c(t,e,n){for(var r=s(e,n),o=0,i=Object.keys(r);o<i.length;o++){var a=i[o];Object.defineProperty(t,a,r[a])}return t}function s(t,e){for(var n={};t.constructor!==Object;){var r=Object.getOwnPropertyDescriptors(t);if(e&&e.length){for(var o={},i=0,a=Object.keys(r);i<a.length;i++)for(var c=a[i],s=0,u=e;s<u.length;s++){var p=u[s],d=!1;switch(p){case k.None:break;case k.Field:d="function"!=typeof r[c].value&&"function"!=typeof r[c].get;break;case k.Property:d="function"==typeof r[c].get;break;case k.Method:d="function"==typeof r[c].value&&"function"!=typeof r[c].get;break;default:throw new Error("Property flag not supported: "+p)}d&&(o[c]=r[c])}r=o}n=Object.assign(r,n),t=f(t)}return n.constructor&&delete n.constructor,n}function u(t,e){if(t&&t.constructor){return t.constructor[e]}}function p(t,e){void 0===e&&(e=!1);for(var n=s(t,[k.Method]),r={},o=0,i=Object.keys(n);o<i.length;o++){var a=i[o];r[a]=n[a].value,e&&(r[a]=r[a].bind(t))}return r}function f(t){if("object"==typeof t)return Object.getPrototypeOf(t);if("function"==typeof t)return t.prototype;throw new Error("Expected an object or a function. Got: "+t)}function d(t){if(!t)return!1;if("object"!=typeof t)return!1;if("function"==typeof Object.getPrototypeOf){var e=Object.getPrototypeOf(t);return e===Object.prototype||null===e}return"[object Object]"===Object.prototype.toString.call(t)}function h(t){if(!t)return!0;var e=typeof t;return"object"!==e&&"function"!==e}function l(t,e){T.getOrInitInfo(t).actions[e]=!0}function g(t,e){C.getOrInitInfo(t).ignoreState[e]=!0}function v(t,e){T.getOrInitInfo(t).sequences[e]=!0}function y(t,e){if(!e)return function(e,n){return b(e,n,t)};b.call(void 0,t,e)}function b(t,e,n){T.getOrInitInfo(t).childIds[e]=n||S}function m(t,e){if(t instanceof e)return!0;var n=P.getInfo(t);return!(!n||n.originalClass!==e)}Object.defineProperty(e,"__esModule",{value:!0});var O,j=Symbol("REDUX-APP.COMPONENT_INFO"),w=Symbol("REDUX-APP.COMPONENT_TEMPLATE_INFO"),I=Symbol("REDUX-APP.CLASS_INFO"),S=Symbol("REDUX-APP.AUTO_ID"),C=function(){function t(){this.ignoreState={}}return t.getInfo=function(t){if(t)return o(t,I)},t.getOrInitInfo=function(e){var n=t.getInfo(e);return n||(n=r(e,I,new t)),n},t}(),P=function(){function t(){}return t.getInfo=function(t){if(t)return o(t,j)},t.initInfo=function(e){return r(e,j,new t)},t}(),A=function(){function t(){this.actionNamespace=!0,this.actionNamespaceSeparator=".",this.uppercaseActions=!1}return t}(),R=function(){function t(){this.updateState=!0}return t}();!function(t){t[t.None=0]="None",t[t.Verbose=1]="Verbose",t[t.Debug=2]="Debug",t[t.Warn=5]="Warn",t[t.Silent=10]="Silent"}(O||(O={}));var k,x=function(){function t(){this.logLevel=O.Warn,this.action=new A}return t}(),N=new x,E=function(){function t(){}return t.prototype.verbose=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.shouldLog(O.Verbose)&&console.debug.apply(console,["VERBOSE [redux-app] "+t].concat(e))},t.prototype.debug=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.shouldLog(O.Debug)&&console.log.apply(console,["DEBUG [redux-app] "+t].concat(e))},t.prototype.warn=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.shouldLog(O.Warn)&&console.warn.apply(console,["WARN [redux-app] "+t].concat(e))},t.prototype.shouldLog=function(t){return N.logLevel!==O.None&&!(N.logLevel>t)},t}(),D=new E;!function(t){t.None="None",t.Field="Field",t.Property="Property",t.Method="Method"}(k||(k={}));var T=function(){function t(){this.actions={},this.sequences={},this.childIds={}}return t.getInfo=function(t){if(t)return"object"==typeof t?u(t,w):o(t,w)},t.getOrInitInfo=function(e){var n=t.getInfo(e);if(!n){var i="function"==typeof e,a=i?e:e.constructor,c=o(a,w),s=Object.assign(new t,c);n=r(a,w,s)}return n},t}(),L=function(){function t(){}return t.isIgnoredProperty=function(t,e){var n=C.getInfo(t);return n&&n.ignoreState[e]},t.removeIgnoredProps=function(t,e){var n=C.getInfo(e);if(!n)return t;for(var r=0,o=Object.keys(n.ignoreState);r<o.length;r++){delete t[o[r]]}return t},t}(),_=function(){function t(){}return t.nextAvailableId=function(){return--t.autoComponentId},t.getComponentId=function(e,n){var r=n.split(".");if(e&&r.length){var o=T.getInfo(e);if(o){var i=r[r.length-1],a=o.childIds[i];if(a){if(a===S){var c=t.nextAvailableId();return D.verbose("[getComponentId] new component id generated: "+c),o.childIds[i]=c,c}return a}}}},t.autoComponentId=0,t}(),M=n(2),U=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},F=n(3),W="root",q={},z=0,V=function(){function t(t){this.visited=new Set,this.path=W,this.forceRecursion=!1,Object.assign(this,t)}return t}(),X=function(){function t(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.warehouse=new Map,this.initialStateUpdated=!1;var r=this.resolveParameters(t,e),o=r.options,i=r.preLoadedState,a=r.enhancer;if(this.name=this.getAppName(o.name),q[this.name])throw new Error("An app with name '"+this.name+"' already exists.");q[this.name]=this;var c=function(t){return t};this.store=Object(M.createStore)(c,i,a);var s=new K({appName:this.name}),u=Q.create(this.store,t,s);this.root=u,this.registerComponents(s.createdComponents);var p=new G({componentPaths:Object.keys(s.createdComponents)}),f=H.combineReducersTree(this.root,p);if(o.updateState){var d=this.updateState(p);this.subscriptionDisposer=this.store.subscribe(d)}this.store.replaceReducer(f)}return t.createApp=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return new(t.bind.apply(t,[void 0,e].concat(n)))},t.getComponent=function(e,n,r){var o=t.getApp(r);if(!o)throw new Error("App not found (id: '"+(r||"default")+"')");var i=o.getTypeWarehouse(e);if(n){var a=i.get(n);if(!a)throw new Error("Component not found. Type: "+e.name+". Id: '"+n+"'.");return a}var a=i.values().next().value;if(!a)throw new Error("Component not found. Type: "+e.name+".");return a},t.getApp=function(t){var e=t||"default",n=q[e];return n||D.debug("[ReduxApp] Application '"+e+"' does not exist."),n},t.prototype.dispose=function(){this.subscriptionDisposer&&(this.subscriptionDisposer(),this.subscriptionDisposer=null),q[this.name]&&delete q[this.name]},t.prototype.resolveParameters=function(t,e){var n={};return 0===e.length?(n.options=new R,n.preLoadedState=t):1===e.length?"function"==typeof e[0]?(n.options=new R,n.enhancer=e[0],n.preLoadedState=t):(n.options=Object.assign(new R,e[0]),n.preLoadedState=t):2===e.length?(n.options=Object.assign(new R,e[0]),n.preLoadedState=e[1]):(n.options=Object.assign(new R,e[0]),n.preLoadedState=e[1],n.enhancer=e[2]),n},t.prototype.getAppName=function(t){return t||(Object.keys(q).length?"default_"+ ++z:"default")},t.prototype.registerComponents=function(t){for(var e=0,n=Object.values(t);e<n.length;e++){var r=n[e],o=P.getInfo(r),i=this.getTypeWarehouse(o.originalClass),a=o.id||_.nextAvailableId();i.set(a,r)}},t.prototype.getTypeWarehouse=function(t){return this.warehouse.has(t)||this.warehouse.set(t,new Map),this.warehouse.get(t)},t.prototype.updateState=function(t){var e=this;return function(){var n=Date.now(),r=e.store.getState();e.initialStateUpdated&&t.invoked?e.updateChangedComponents((i={},i[W]=r,i),t.changedComponents):(e.initialStateUpdated=!0,e.updateStateRecursion(e.root,r,new V({forceRecursion:!0}))),t.reset();var o=Date.now();D.debug("[updateState] Component tree updated in "+(o-n)+"ms.");var i}},t.prototype.updateChangedComponents=function(t,e){for(var n=Object.keys(e),r=new V,o=0,i=n;o<i.length;o++){var a=i[o],c=e[a],s=F(t,a);this.updateStateRecursion(c,s,U({},r,{path:a}))}},t.prototype.updateStateRecursion=function(t,e,n){if(t===e)return e;if(h(t)||h(e))return e;if(n.visited.has(t))return t;if(n.visited.add(t),n.forceRecursion||t instanceof Q){var r;r=Array.isArray(t)&&Array.isArray(e)?this.updateArray(t,e,n):this.updateObject(t,e,n)}else t=e,r="Object overwritten.";return r&&r.length&&(D.debug("[updateState] Change in '"+n.path+"'. "+r),D.verbose("[updateState] New state: ",t)),t},t.prototype.updateObject=function(t,e,n){for(var r=[],o=0,i=Object.keys(t);o<i.length;o++){var a=i[o];if(!L.isIgnoredProperty(t,a)&&!e.hasOwnProperty(a)){var c=Object.getOwnPropertyDescriptor(t,a);if(c&&"function"==typeof c.get)continue;"function"==typeof t[a]&&D.warn("[updateState] Function property removed in path: "+n.path+"."+a+". Consider using a method instead."),delete t[a],r.push(a)}}for(var s=[],u=0,p=Object.keys(e);u<p.length;u++){var a=p[u];if(!L.isIgnoredProperty(t,a)){var c=Object.getOwnPropertyDescriptor(t,a);if(!c||"function"!=typeof c.get||"function"==typeof c.set){var f=e[a],d=t[a],h=this.updateStateRecursion(d,f,U({},n,{path:n.path+"."+a}));h!==d&&(t[a]=h,s.push(a))}}}if(s.length||r.length){var l=s.length?"Props assigned: "+s.join(", ")+".":"",g=r.length?"Props deleted: "+r.join(", ")+".":"";return l+(s.length&&r.length?" ":"")+g}return null},t.prototype.updateArray=function(t,e,n){for(var r=[],o=t.length,i=e.length,a=[],c=0;c<Math.min(o,i);c++){var s=e[c],u=t[c],p=this.updateStateRecursion(u,s,U({},n,{path:n.path+"."+c}));p!==u&&(t[c]=p,a.push(c))}if(a.length&&r.push("Assigned item(s) at indexes "+a.join(", ")+"."),i>o){var f=e.slice(o);Array.prototype.push.apply(t,f),r.push("Added "+(i-o)+" item(s) at index "+o+".")}else o>i&&(t.splice(i),r.push("Removed "+(o-i)+" item(s) at index "+i+"."));return r.join(" ")},t.options=N,t}(),B=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},G=function(){function t(t){this.visited=new Set,this.path=W,this.componentPaths=[],this.changedComponents={},this.invoked=!1,Object.assign(this,t)}return t.prototype.reset=function(){a(this.changedComponents),this.invoked=!1},t}(),H=function(){function t(){}return t.createReducer=function(e,n){var r=T.getInfo(n);if(!r)throw new Error("Inconsistent component '"+n.constructor.name+"'. The 'component' class decorator is missing.");var o=t.createMethodsLookup(n,r),i=t.createStateObjectPrototype(e,r),a=P.getInfo(e).id;return function(r){function c(c,s){if(D.verbose("[reducer] Reducer of: "+n.constructor.name+", action: "+s.type),void 0===c)return D.verbose("[reducer] State is undefined, returning initial value"),e;if(a!==s.id)return D.verbose("[reducer] Component id and action.id don't match ("+a+" !== "+s.id+")"),c;var u=o[s.type];if(!u)return D.verbose("[reducer] No matching action in this reducer, returning previous state"),c;var p=t.createStateObject(c,i);return u.call.apply(u,[p].concat(s.payload)),r(e),D.verbose("[reducer] Reducer invoked, returning new state"),p}return function(n,r){var o=c(n,r);return h(o)||d(o)||(o=t.finalizeStateObject(o,e)),o}}},t.combineReducersTree=function(e,n){var r=t.combineReducersRecursion(e,n);return function(t,e){var o=Date.now();n.invoked=!0,D.debug("[rootReducer] Reducing action: "+e.type+".");var i=r(t,e),a=Date.now();return D.debug("[rootReducer] Reducer tree processed in "+(a-o)+"ms."),i}},t.createMethodsLookup=function(t,e){var n=p(t),r={};return Object.keys(e.actions).forEach(function(e){var o=Z.getActionName(t,e);r[o]=n[e]}),r},t.createStateObjectPrototype=function(e,n){for(var r=c({},e,[k.Property]),o=p(e),i=0,a=Object.keys(o);i<a.length;i++){var s=a[i];n.actions[s]?r[s]=t.actionInvokedError:r[s]=o[s].bind(e)}return r},t.actionInvokedError=function(){throw new Error("Only 'noDispatch' methods can be invoked inside actions.")},t.createStateObject=function(t,e){for(var n=Object.create(e),r=0,o=Object.keys(t);r<o.length;r++){var i=o[r],a=Object.getOwnPropertyDescriptor(e,i);a&&"function"==typeof a.get&&"function"!=typeof a.set||(n[i]=t[i])}return n},t.finalizeStateObject=function(t,e){D.verbose("[finalizeStateObject] finalizing state.");var n=Object.assign({},t);return n=L.removeIgnoredProps(n,e),D.verbose("[finalizeStateObject] state finalized."),n},t.combineReducersRecursion=function(e,n){if(!h(e)&&!n.visited.has(e)){if(n.visited.add(e),!n.componentPaths.some(function(t){return t.startsWith(n.path)}))return t.identityReducer;var r,o=P.getInfo(e);r=o?o.reducerCreator(function(t){n.changedComponents[n.path]=t}):t.identityReducer;for(var a={},c=0,s=Object.keys(e);c<s.length;c++){var u=s[c],p=t.combineReducersRecursion(e[u],new G(B({},n,{path:""===n.path?u:n.path+"."+u})));"function"==typeof p&&(a[u]=p)}var f=r;if(Object.keys(a).length){var d=i(a);f=function(e,n){var o=r(e,n),i=d(o,n);return t.mergeState(o,i)}}return f}},t.mergeState=function(t,e){if(Array.isArray(t)&&Array.isArray(e)){for(var n=0;n<e.length;n++)t[n]=e[n];return t}return B({},t,e)},t.identityReducer=function(t){return t},t}(),J=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},K=function(){function t(t){this.visitedNodes=new Set,this.visitedTemplates=new Map,this.path=W,this.createdComponents={},Object.assign(this,t)}return t}(),Q=function(){function t(e,n,r){if(!T.getInfo(n))throw new Error("Argument 'template' is not a component template. Did you forget to use the decorator?");t.createSelf(this,e,n,r),r.createdComponents[r.path]=this,r.visitedTemplates.set(n,this),D.verbose("[Component] New "+n.constructor.name+" component created. Path: "+r.path),t.createSubComponents(this,e,n,r)}return t.create=function(e,n,r){return r=Object.assign(new K,r),T.getOrInitInfo(n),new(t.getComponentClass(n))(e,n,r)},t.getComponentClass=function(e){var n=T.getInfo(e);return n.componentClass||(n.componentClass=t.createComponentClass(e),n.originalClass=e.constructor),n.componentClass},t.createComponentClass=function(e){var n=new Function("initCallback",'"use strict";return function '+e.constructor.name+"_ReduxAppComponent() { initCallback(this, arguments); }"),r=n(function(e,n){return t.apply(e,n)});r.prototype=Object.create(t.prototype),r.prototype.constructor=r;var o=Z.createActions(e);return Object.assign(r.prototype,o),r},t.createSelf=function(t,e,n,r){c(t,n,[k.Field,k.Property]);var o=P.initInfo(t),i=C.getOrInitInfo(t),a=T.getInfo(n),s=C.getInfo(n)||new C;o.id=_.getComponentId(r.parentTemplate,r.path),o.originalClass=a.originalClass,i.ignoreState=s.ignoreState,o.dispatch=e.dispatch,o.reducerCreator=H.createReducer(t,n)},t.createSubComponents=function(e,n,r,o){if(!h(e)&&!o.visitedNodes.has(e)){o.visitedNodes.add(e);for(var i=r||e,a=0,c=Object.keys(i);a<c.length;a++){var s=c[a],u=o.path+"."+s,p=i[s];T.getInfo(p)?o.visitedTemplates.has(p)?e[s]=o.visitedTemplates.get(p):e[s]=t.create(n,p,J({},o,{parentTemplate:r,path:u})):t.createSubComponents(e[s],n,null,J({},o,{parentTemplate:null,path:u}))}}},t}(),Y=n(4),Z=function(){function t(){}return t.createActions=function(e){var n=p(e);if(n){var r=T.getInfo(e),o={};return Object.keys(n).forEach(function(i){o[i]=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];if(!(this instanceof Q))throw new Error("Component method invoked with non-Component as 'this'. Bound 'this' argument is: "+this);var c=n[i];if(r.actions[i]||r.sequences[i]){var s=P.getInfo(this),u={type:t.getActionName(e,i),id:s?s.id:void 0,payload:o};s.dispatch(u)}if(!r.actions[i])return c.call.apply(c,[this].concat(o))}}),o}},t.getActionName=function(t,e){var n=Object.assign(new A,N.action),r=e,o=t.constructor.name;return n.uppercaseActions&&(r=Y(r).toUpperCase(),o=Y(o).toUpperCase()),n.actionNamespace&&(r=o+n.actionNamespaceSeparator+r),r},t}();n.d(e,"isInstanceOf",function(){return m}),n.d(e,"action",function(){return l}),n.d(e,"ignoreState",function(){return g}),n.d(e,"sequence",function(){return v}),n.d(e,"withId",function(){return y}),n.d(e,"ActionOptions",function(){return A}),n.d(e,"AppOptions",function(){return R}),n.d(e,"GlobalOptions",function(){return x}),n.d(e,"LogLevel",function(){return O}),n.d(e,"getMethods",function(){return p}),n.d(e,"ReduxApp",function(){return X})},function(t,e){t.exports=require("redux")},function(t,e){t.exports=require("lodash.get")},function(t,e){t.exports=require("lodash.snakecase")}])});