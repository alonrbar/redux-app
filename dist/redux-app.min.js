!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("redux-app",[],t):"object"==typeof exports?exports["redux-app"]=t():e["redux-app"]=t()}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(e,t,n){"use strict";function o(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),o(n(10)),o(n(5)),o(n(7)),o(n(23))},function(e,t,n){"use strict";function o(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),o(n(14)),o(n(15)),o(n(16)),o(n(17))},function(e,t,n){"use strict";function o(e,t,n){var o=t,i=e.constructor.name;return n.uppercaseActions&&(o=r(o).toUpperCase(),i=r(i).toUpperCase()),n.actionNamespace&&(o=i+"."+o),o}Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),i=function(){function e(){this.actionNamespace=!0,this.uppercaseActions=!0}return e}();t.SchemaOptions=i,t.getActionName=o;var a=function(){function e(){this.updateState=!0}return e}();t.AppOptions=a;var c;!function(e){e[e.None=0]="None",e[e.Verbose=1]="Verbose",e[e.Debug=2]="Debug",e[e.Warn=5]="Warn",e[e.Silent=10]="Silent"}(c=t.LogLevel||(t.LogLevel={}));var s=function(){function e(){this.logLevel=c.Warn,this.emitClassNames=!1,this.schema=new i}return e}();t.GlobalOptions=s,t.globalOptions=new s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(20),r=n(0),i=n(2),a=n(1);t.DEFAULT_APP_NAME="default",t.appsRepository={};var c=0,s=function(){function e(e){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var a=this;this.warehouse=new Map;var c=this.resolveParameters(n),s=c.options,u=c.preLoadedState,p=c.enhancer;if(this.name=this.getAppName(s.name),t.appsRepository[this.name])throw new Error("An app with name '"+this.name+"' already exists.");t.appsRepository[this.name]=this;var f=function(e){return e};this.store=o.createStore(f,u,p);var d=r.Component.create(this.store,e,null,[this.name]);this.root=d,s.updateState&&(this.subscriptionDisposer=this.store.subscribe(function(){return a.updateState()}));var l=r.Component.getReducerFromTree(d);this.store.replaceReducer(l)}return e.createApp=function(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];return new(e.bind.apply(e,[void 0,t].concat(n)))},e.prototype.dispose=function(){this.subscriptionDisposer&&(this.subscriptionDisposer(),this.subscriptionDisposer=null),t.appsRepository[this.name]&&delete t.appsRepository[this.name]},e.prototype.getTypeWarehouse=function(e){return this.warehouse.has(e)||this.warehouse.set(e,new Map),this.warehouse.get(e)},e.prototype.getAppName=function(e){return e||(Object.keys(t.appsRepository).length?t.DEFAULT_APP_NAME+"_"+ ++c:t.DEFAULT_APP_NAME)},e.prototype.updateState=function(){var e=this.store.getState();a.log.verbose("[updateState] Store before: ",e);var t=new Set;this.updateStateRecursion(this.root,e,[],t),a.log.verbose("[updateState] Store after: ",e)},e.prototype.updateStateRecursion=function(e,t,n,o){if(e===t)return t;if(a.isPrimitive(e)||a.isPrimitive(t))return t;if(o.has(e))return e;o.add(e);var r=e.constructor,i=t.constructor;if(r!==i&&i!==Object)return t;var c;return c=Array.isArray(e)&&Array.isArray(t)?this.updateArray(e,t,n,o):this.updateObject(e,t,n,o),c&&c.length?(a.log.debug("[updateState] App state in path '"+a.pathString(n)+"' changed."),a.log.debug("[updateState] "+c),a.log.verbose("[updateState] New state: ",e)):a.log.verbose("[updateState] No change in path '"+a.pathString(n)+"'."),e},e.prototype.updateObject=function(e,t,n,o){var r=this,i=[];Object.keys(e).forEach(function(n){t.hasOwnProperty(n)||(delete e[n],i.push(n))});var a=[];if(Object.keys(t).forEach(function(i){var c=t[i],s=e[i],u=r.updateStateRecursion(s,c,n.concat(i),o);u!==s&&(e[i]=u,a.push(i))}),i.length||a.length){var c="Props deleted: "+(i.length?i.join(", "):"<none>")+".";return"Props assigned: "+(a.length?a.join(", "):"<none>")+"."+" "+c}return null},e.prototype.updateArray=function(e,t,n,o){for(var r=[],i=e.length,a=t.length,c=[],s=0;s<Math.min(i,a);s++){var u=t[s],p=e[s],f=this.updateStateRecursion(p,u,n.concat(s.toString()),o);f!==p&&(e[s]=f,c.push(s))}if(c.length&&r.push("Assigned item(s) at indexes "+c.join(", ")+"."),a>i){var d=t.slice(i);Array.prototype.push.apply(e,d),r.push("Added "+(a-i)+" item(s) at index "+i+".")}else i>a&&(e.splice(a),r.push("Removed "+(i-a)+" item(s) at index "+a+"."));return r.join(" ")},e.prototype.resolveParameters=function(e){var t={};return 0===e.length?t.options=new i.AppOptions:1===e.length?"function"==typeof e[0]?(t.options=new i.AppOptions,t.enhancer=e[0]):t.options=Object.assign(new i.AppOptions,e[0]):2===e.length?(t.options=Object.assign(new i.AppOptions,e[0]),t.preLoadedState=JSON.parse(JSON.stringify(e[1]))):(t.options=Object.assign(new i.AppOptions,e[0]),t.preLoadedState=JSON.parse(JSON.stringify(e[1])),t.enhancer=e[2]),t},e.options=i.globalOptions,e}();t.ReduxApp=s},function(e,t,n){"use strict";function o(e,t,n){return e[t]=n}function r(e,t){return e[t]}Object.defineProperty(t,"__esModule",{value:!0}),t.setSymbol=o,t.getSymbol=r,t.COMPONENT_META=Symbol("REDUX-APP.COMPONENT_METADATA"),t.COMPONENT_SCHEMA=Symbol("REDUX-APP.COMPONENT_SCHEMA"),t.AUTO_ID=Symbol("REDUX-APP.AUTO_ID")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),r=function(){function e(){this.disposables=[],this.computedGetters={}}return e.getMeta=function(e){return o.getSymbol(e,o.COMPONENT_META)},e.createMeta=function(t){return o.setSymbol(t,o.COMPONENT_META,new e)},e}();t.Metadata=r},function(e,t,n){"use strict";function o(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),o(n(11)),o(n(13)),o(n(18)),o(n(21)),o(n(22))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),r=n(1),i=function(){function e(){this.computedGetters={},this.connectedProps={},this.noDispatch={},this.childIds={}}return e.getSchema=function(e){if(e)return"object"==typeof e?r.getConstructorProp(e,o.COMPONENT_SCHEMA):o.getSymbol(e,o.COMPONENT_SCHEMA)},e.getOrCreateSchema=function(t){var n=e.getSchema(t);if(!n){var r="function"==typeof t,i=r?t:t.constructor;n=o.setSymbol(i,o.COMPONENT_SCHEMA,new e)}return n},e.assertSchema=function(t,n){if(!e.getSchema(t))throw new Error(n||"Invalid argument. Decorated component expected.")},e}();t.Schema=i},function(e,t,n){e.exports=n(9)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0);t.isInstanceOf=o.isInstanceOf;var r=n(6);t.component=r.component,t.connect=r.connect,t.computed=r.computed,t.noDispatch=r.noDispatch,t.sequence=r.sequence,t.withId=r.withId;var i=n(2);t.SchemaOptions=i.SchemaOptions,t.AppOptions=i.AppOptions,t.GlobalOptions=i.GlobalOptions,t.LogLevel=i.LogLevel;var a=n(3);t.ReduxApp=a.ReduxApp},function(e,t,n){"use strict";var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=n(2),c=n(3),s=n(1),u=n(5),p=n(7),f=function(){function e(t,n,o,r,i){if(void 0===r&&(r=[]),void 0===i&&(i=new Set),!p.Schema.getSchema(n))throw new Error("Argument 'creator' is not a component creator. Did you forget to use the decorator?");e.createSelf(this,t,n,o,r),e.createSubComponents(this,t,n,r,i),s.log.debug("[Component] New "+n.constructor.name+" component created. path: "+s.pathString(r))}return e.create=function(t,n,o,r,i){void 0===r&&(r=[]),void 0===i&&(i=new Set);var a=e.getComponentClass(n),s=new a(t,n,o,r,i),f=r[0]||c.DEFAULT_APP_NAME,d=c.appsRepository[f],l=r[r.length-1],h=p.Schema.getSchema(n).connectedProps[l];if(d&&!h){var g=d.getTypeWarehouse(n.constructor),v=u.Metadata.getMeta(s).id||g.size;g.set(v,s)}return s},e.getReducerFromTree=function(t,n){if(void 0===n&&(n=new Set),!s.isPrimitive(t)&&!n.has(t)){n.add(t);var o,a=u.Metadata.getMeta(t);o=a?a.reducer:e.identityReducer;for(var c={},p=0,f=Object.keys(t);p<f.length;p++){var d=f[p],l=e.getReducerFromTree(t[d],n);"function"==typeof l&&(c[d]=l)}var h=o;if(Object.keys(c).length){var g=s.simpleCombineReducers(c);h=function(e,t){var n=o(e,t),i=g(n,t);return r({},n,i)}}return i.Computed.wrapReducer(h,t)}},e.getComponentClass=function(t){var n=p.Schema.getSchema(t);return n.componentClass||(n.componentClass=e.createComponentClass(t),n.originalClass=t.constructor),n.componentClass},e.createComponentClass=function(t){var n=function(e){function n(n,o){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var c=e.apply(this,[n,o].concat(r))||this;return c.__originalClassName__=t.constructor.name,a.globalOptions.emitClassNames||delete c.__originalClassName__,c}return o(n,e),n}(e),r=e.createActions(t);return Object.assign(n.prototype,r),n},e.createActions=function(t){var n=s.getMethods(t);if(n){var o=p.Schema.getSchema(t),r={};return Object.keys(n).forEach(function(i){r[i]=function(){for(var r=[],c=0;c<arguments.length;c++)r[c]=arguments[c];if(!(this instanceof e))throw new Error("Component method invoked with non-Component as 'this'. Bound 'this' argument is: "+this);var s=n[i];if(o.noDispatch[i])s.call.apply(s,[this].concat(r));else{var p=u.Metadata.getMeta(this);p.dispatch({type:a.getActionName(t,i,o.options),id:p?p.id:void 0,payload:r})}}}),r}},e.createSelf=function(t,n,o,r,a){for(var c=0,s=Object.getOwnPropertyNames(o);c<s.length;c++){var f=s[c],d=Object.getOwnPropertyDescriptor(o,f);Object.defineProperty(t,f,d)}var l=u.Metadata.createMeta(t),h=p.Schema.getSchema(o);l.id=i.ComponentId.getComponentId(r,a),l.originalClass=h.originalClass,i.Computed.setupComputedProps(t,h,l),l.dispatch=n.dispatch,l.reducer=e.createReducer(t,o)},e.createSubComponents=function(t,n,o,r,i){if(!s.isPrimitive(t)&&!i.has(t)){i.add(t);for(var a=o||t,c=0,u=Object.keys(a);c<u.length;c++){var f=u[c],d=r.concat([f]),l=a[f];p.Schema.getSchema(l)?t[f]=e.create(n,l,o,d,i):e.createSubComponents(t[f],n,null,d,i)}}},e.createReducer=function(e,t){var n=s.getMethods(t),o=p.Schema.getSchema(t).options,r={};Object.keys(n).forEach(function(e){var n=a.getActionName(t,e,o);r[n]=e});var i=u.Metadata.getMeta(e).id;return function(o,a){if(s.log.verbose("[reducer] Reducer of: "+t.constructor.name+", action: "+a.type),void 0===o)return s.log.verbose("[reducer] State is undefined, returning initial value"),e;if(i!==a.id)return s.log.verbose("[reducer] Component id and action.id don't match ("+i+" !== "+a.id+")"),o;var c=r[a.type],u=n[c];if(!u)return s.log.verbose("[reducer] No matching action in this reducer, returning previous state"),o;var p=Object.assign({},o);return u.call.apply(u,[p].concat(a.payload)),s.log.verbose("[reducer] Reducer invoked, returning new state"),p}},e.identityReducer=function(e){return e},e}();t.Component=f},function(e,t,n){"use strict";function o(e){if("function"!=typeof e)return function(t){return r(t,e)};r.call(void 0,e)}function r(e,t){a.Schema.getOrCreateSchema(e).options=Object.assign({},t,new i.SchemaOptions,i.globalOptions.schema)}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),a=n(0);t.component=o},function(e,t){e.exports=require("lodash.snakecase")},function(e,t,n){"use strict";function o(e,t){var n=Object.getOwnPropertyDescriptor(e,t);if("function"!=typeof n.get)throw new Error("Failed to decorate '"+t+"'. The 'computed' decorator should only be used on getters.");if(n.set)throw new Error("Failed to decorate '"+t+"'. Decorated property should not have a setter.");delete e[t],Object.defineProperty(e,t,i.dataDescriptor),r.Schema.getOrCreateSchema(e).computedGetters[t]=n.get}Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(1);t.computed=o;var a=function(){function e(){}return e.wrapReducer=function(t,n){return function(o,r){var i=t(o,r);return e.computeProps(n,i),i}},e.setupComputedProps=function(e,t,n){for(var o=0,r=Object.keys(t.computedGetters);o<r.length;o++){delete e[r[o]]}n.computedGetters=t.computedGetters},e.computeProps=function(e,t){var n=r.Metadata.getMeta(e);if(n)for(var o=0,a=Object.keys(n.computedGetters);o<a.length;o++){var c=a[o],s=n.computedGetters[c];i.log.verbose("[computeProps] computing new value of '"+c+"'");var u=s.call(t),p=t[c];u!==p&&(i.log.verbose("[computeProps] updating the state of '"+c+"'. New value: '"+u+"', Old value: '"+p+"'."),delete t[c],t[c]=u)}},e}();t.Computed=a},function(e,t,n){"use strict";function o(e,t,n){var o=function(e){return function(o){if(Object.defineProperty(this,t,n),e)return this[t];this[t]=o}};return Object.defineProperty(e,t,{get:o(!0),set:o(!1),enumerable:!0,configurable:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.dataDescriptor={writable:!0,configurable:!0,enumerable:!0},t.accessorDescriptor={configurable:!0,enumerable:!0},t.deferredDefineProperty=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),r=function(){function e(){}return e.prototype.verbose=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.shouldLog(o.LogLevel.Verbose)&&console.debug.apply(console,["VERBOSE [redux-app] "+e].concat(t))},e.prototype.debug=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.shouldLog(o.LogLevel.Debug)&&console.log.apply(console,["DEBUG [redux-app] "+e].concat(t))},e.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.shouldLog(o.LogLevel.Warn)&&console.warn.apply(console,["WARN [redux-app] "+e].concat(t))},e.prototype.shouldLog=function(e){return o.globalOptions.logLevel!==o.LogLevel.None&&!(o.globalOptions.logLevel>e)},e}();t.log=new r},function(e,t,n){"use strict";function o(e){var t=Object.keys(e);return function(n,o){void 0===n&&(n={});for(var r=!1,i={},a=0,c=t;a<c.length;a++){var s=c[a],u=e[s],p=n[s],f=u(p,o);i[s]=f,r=r||f!==p}return r?i:n}}Object.defineProperty(t,"__esModule",{value:!0}),t.simpleCombineReducers=o},function(e,t,n){"use strict";function o(e){if(!e)return!0;var t=typeof e;return"object"!==t&&"function"!==t}function r(e){if(e){var t=Object.getPrototypeOf(e);if(t){for(var n={},o=0,r=Object.keys(t);o<r.length;o++){var i=r[o],a=Object.getOwnPropertyDescriptor(t,i);a&&"function"==typeof a.get||"function"!=typeof t[i]||(n[i]=t[i])}return n}}}function i(e,t){return"string"==typeof t&&(t=t.replace(/\[|\]/g,".").split(".").filter(function(e){return"string"==typeof e&&""!==e.trim()})),t.reduce(function(e,t){if("object"==typeof e&&t)return e[t.toString()]},e)}function a(e,t){return e&&e.constructor&&e.constructor[t]}function c(e){return e.length?"root."+e.join("."):"root"}Object.defineProperty(t,"__esModule",{value:!0}),t.isPrimitive=o,t.getMethods=r,t.getProp=i,t.getConstructorProp=a,t.pathString=c},function(e,t,n){"use strict";function o(e,t){if(!t)return function(t,n){return r(t,n,e)};r.call(void 0,e,t)}function r(e,t,n){n=Object.assign(new c,n);var o=e[t],r=Reflect.getMetadata("design:type",e,t);if(!r){var s="[connect] Failed to reflect type of property '"+t+"'. Make sure you're using TypeScript and that the 'emitDecoratorMetadata' compiler option in your tsconfig.json file is turned on. Note that even if TypeScript is configured correctly it may fail to reflect property types due to the loading order of your classes. In that case, make sure that the type of '"+t+"' is loaded prior to the type of it's containing class ("+e.constructor.name+").";throw new Error(s)}var u=Object.getOwnPropertyDescriptor(e,t),p={get:function(){var e=i.appsRepository[n.app];if(!e)return a.log.debug("[connect] Application '"+n.app+"' does not exist. Property "+t+" is not connected."),u&&u.get?u.get():o;var c,s=e.getTypeWarehouse(r);return c=n.id?s.get(n.id):s.values().next().value,c&&!n.live&&(Object.defineProperty(this,t,a.dataDescriptor),o=this[t]=c,a.log.debug("[connect] Property '"+t+"' connected. Type: "+r.name+".")),c},set:function(e){return i.appsRepository[n.app]&&a.log.warn("[connect] Connected component '"+t+"' value assigned. Component disconnected."),u&&u.set?u.set(e):!u||u&&u.writable?o=e:void 0}};return a.deferredDefineProperty(e,t,Object.assign({},a.accessorDescriptor,p))}Object.defineProperty(t,"__esModule",{value:!0}),n(19);var i=n(3),a=n(1),c=function(){function e(){this.app=i.DEFAULT_APP_NAME,this.live=!1}return e}();t.ConnectOptions=c,t.connect=o},function(e,t){e.exports=require("reflect-metadata")},function(e,t){e.exports=require("redux")},function(e,t,n){"use strict";function o(e,t){i(e,t)}function r(e,t){i(e,t)}function i(e,t){a.Schema.getOrCreateSchema(e).noDispatch[t]=!0}Object.defineProperty(t,"__esModule",{value:!0});var a=n(0);t.noDispatch=o,t.sequence=r},function(e,t,n){"use strict";function o(e,t){if(!t)return function(t,n){return r(t,n,e)};r.call(void 0,e,t)}function r(e,t,n){i.Schema.getOrCreateSchema(e).childIds[t]=n||a.AUTO_ID}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(4),c=n(1);t.withId=o;var s=function(){function e(){}return e.getComponentId=function(t,n){var o=i.Schema.getSchema(t);if(t&&n.length){var r=n[n.length-1],s=o.childIds[r];if(s){if(s===a.AUTO_ID){var u=--e.autoComponentId;return c.log.verbose("[getComponentId] new component id generated: "+u),o.childIds[r]=u,u}return s}}},e.autoComponentId=0,e}();t.ComponentId=s},function(e,t,n){"use strict";function o(e,t){if(e instanceof t)return!0;var n=r.Metadata.getMeta(e);return!(!n||n.originalClass!==t)}Object.defineProperty(t,"__esModule",{value:!0});var r=n(5);t.isInstanceOf=o}])});