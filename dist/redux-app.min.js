!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("redux-app",[],e):"object"==typeof exports?exports["redux-app"]=e():t["redux-app"]=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";function r(t){return"symbol"==typeof t||t instanceof Symbol}function o(t,e,n){return t[e]=n}function i(t,e){return t[e]}function a(t,e){return Object.getOwnPropertySymbols(t).includes(e)&&i(t,e)}function u(t){var e=Object.keys(t);return function(n,r){void 0===n&&(n={});for(var o=!1,i={},a=0,u=e;a<u.length;a++){var s=u[a],c=t[s],f=n[s],p=c(f,r);i[s]=p,o=o||p!==f}return o?i:n}}function s(t,e,n){for(var r=c(e,n),o=0,i=Object.keys(r);o<i.length;o++){var a=i[o];Object.defineProperty(t,a,r[a])}return t}function c(t,e){for(var n={};t.constructor!==Object;){var r=Object.getOwnPropertyDescriptors(t);if(e&&e.length){for(var o={},i=0,a=Object.keys(r);i<a.length;i++)for(var u=a[i],s=0,c=e;s<c.length;s++){var f=c[s],p=!1;switch(f){case N.None:break;case N.Field:p="function"!=typeof r[u].value&&"function"!=typeof r[u].get;break;case N.Property:p="function"==typeof r[u].get;break;case N.Method:p="function"==typeof r[u].value&&"function"!=typeof r[u].get;break;default:throw new Error("Property flag not supported: "+f)}p&&(o[u]=r[u])}r=o}n=Object.assign(r,n),t=h(t)}return n.constructor&&delete n.constructor,n}function f(t,e){if(t&&t.constructor){return t.constructor[e]}}function p(t,e){if(t&&t.constructor){var n=t.constructor;return r(e)&&Object.getOwnPropertySymbols(n).includes(e)?n[e]:"string"==typeof e&&Object.getOwnPropertyNames(n).includes(e)?n[e]:void 0}}function d(t,e){void 0===e&&(e=!1);for(var n=c(t,[N.Method]),r={},o=0,i=Object.keys(n);o<i.length;o++){var a=i[o];r[a]=n[a].value,e&&(r[a]=r[a].bind(t))}return r}function h(t){if("object"==typeof t)return Object.getPrototypeOf(t);if("function"==typeof t)return t.prototype;throw new Error("Expected an object or a function. Got: "+t)}function l(t){if(!t)return!0;var e=typeof t;return"object"!==e&&"function"!==e}function g(t,e){L.getOrInitInfo(t).actions[e]=!0}function v(t){L.getOrInitInfo(t)}function y(t,e){A.getOrInitInfo(t).ignoreState[e]=!0}function b(t,e){L.getOrInitInfo(t).sequences[e]=!0}function m(t,e){if(!e)return function(e,n){return O(e,n,t)};O.call(void 0,t,e)}function O(t,e,n){L.getOrInitInfo(t).childIds[e]=n||P}function w(t,e){if(t instanceof e)return!0;var n=R.getInfo(t);return!(!n||n.originalClass!==e)}Object.defineProperty(e,"__esModule",{value:!0});var I,j=Symbol("REDUX-APP.COMPONENT_INFO"),S=Symbol("REDUX-APP.COMPONENT_TEMPLATE_INFO"),C=Symbol("REDUX-APP.CLASS_INFO"),P=Symbol("REDUX-APP.AUTO_ID"),A=function(){function t(){this.ignoreState={}}return t.getInfo=function(t){if(t)return i(t,C)},t.getOrInitInfo=function(e){var n=t.getInfo(e);return n||(n=o(e,C,new t)),n},t}(),R=function(){function t(t,e,n){this.originalClass=t.constructor,this.dispatch=e,this.id=n}return t.getInfo=function(t){if(t)return i(t,j)},t.initInfo=function(e,n,r,i){var a=new t(n,r,i);return o(e,j,a)},t}(),x=function(){function t(){}return t}();!function(t){t[t.None=0]="None",t[t.Verbose=1]="Verbose",t[t.Debug=2]="Debug",t[t.Warn=5]="Warn",t[t.Silent=10]="Silent"}(I||(I={}));var N,k=function(){function t(){this.logLevel=I.Warn,this.actionNameResolver=function(t,e){return"["+t+"] "+e}}return t}(),E=new k,D=function(){function t(){}return t.prototype.verbose=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.shouldLog(I.Verbose)&&console.debug.apply(console,["VERBOSE [redux-app] "+t].concat(e))},t.prototype.debug=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.shouldLog(I.Debug)&&console.log.apply(console,["DEBUG [redux-app] "+t].concat(e))},t.prototype.warn=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.shouldLog(I.Warn)&&console.warn.apply(console,["WARN [redux-app] "+t].concat(e))},t.prototype.shouldLog=function(t){return E.logLevel!==I.None&&!(E.logLevel>t)},t}(),T=new D;!function(t){t.None="None",t.Field="Field",t.Property="Property",t.Method="Method"}(N||(N={}));var L=function(){function t(){this.actions={},this.sequences={},this.childIds={}}return t.getInfo=function(e){if(e){var n=t.getOwnInfo(e);if(n)return n;return t.getBaseInfo(e)?t.initInfo(e):void 0}},t.getOrInitInfo=function(e){var n=t.getInfo(e);return n||t.initInfo(e)},t.getOwnInfo=function(t){return"object"==typeof t?p(t,S):a(t,S)},t.getBaseInfo=function(t){return"object"==typeof t?f(t,S):i(t,S)},t.initInfo=function(e){var n="function"==typeof e,r=n?e:e.constructor,a=i(r,S),u=Object.assign(new t,a);return o(r,S,u)},t}(),M=function(){function t(){}return t.isIgnoredProperty=function(t,e){var n=A.getInfo(t);return n&&n.ignoreState[e]},t.removeIgnoredProps=function(t,e){var n=A.getInfo(e);if(!n)return t;for(var r=0,o=Object.keys(n.ignoreState);r<o.length;r++){delete t[o[r]]}return t},t}(),_=function(){function t(){}return t.nextAvailableId=function(){return--t.autoComponentId},t.getComponentId=function(e,n){var r=n.split(".");if(e&&r.length){var o=L.getInfo(e);if(o){var i=r[r.length-1],a=o.childIds[i];if(a){if(a===P){var u=t.nextAvailableId();return T.verbose("[getComponentId] new component id generated: "+u),o.childIds[i]=u,u}return a}}}},t.autoComponentId=0,t}(),F=n(2),U=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},W="root",z={},q=0,B=function(){function t(t){this.visited=new Set,this.path=W,Object.assign(this,t)}return t}(),V=function(){function t(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.warehouse=new Map,this.initialStateUpdated=!1;var r=this.resolveParameters(t,e),o=r.options,i=r.preLoadedState,a=r.enhancer;if(this.name=this.getAppName(o.name),z[this.name])throw new Error("An app with name '"+this.name+"' already exists.");z[this.name]=this;var u=function(t){return t};this.store=Object(F.createStore)(u,i,a);var s=new K({appName:this.name}),c=Q.create(this.store,t,s);this.root=c,this.registerComponents(s.createdComponents);var f=new G({componentPaths:Object.keys(s.createdComponents)}),p=H.combineReducersTree(this.root,f),d=this.updateState(f);this.subscriptionDisposer=this.store.subscribe(d),this.store.replaceReducer(p)}return t.createApp=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return new(t.bind.apply(t,[void 0,e].concat(n)))},t.getComponent=function(e,n,r){var o=t.getApp(r);if(!o)throw new Error("App not found (id: '"+(r||"default")+"')");var i=o.getTypeWarehouse(e);if(n){var a=i.get(n);if(!a)throw new Error("Component not found. Type: "+e.name+". Id: '"+n+"'.");return a}var a=i.values().next().value;if(!a)throw new Error("Component not found. Type: "+e.name+".");return a},t.getApp=function(t){var e=t||"default",n=z[e];return n||T.debug("[ReduxApp] Application '"+e+"' does not exist."),n},t.prototype.dispose=function(){this.subscriptionDisposer&&(this.subscriptionDisposer(),this.subscriptionDisposer=null),z[this.name]&&delete z[this.name]},t.prototype.resolveParameters=function(t,e){var n={};return 0===e.length?(n.options=new x,n.preLoadedState=t):1===e.length?"function"==typeof e[0]?(n.options=new x,n.enhancer=e[0],n.preLoadedState=t):(n.options=Object.assign(new x,e[0]),n.preLoadedState=t):2===e.length?(n.options=Object.assign(new x,e[0]),n.preLoadedState=e[1]):(n.options=Object.assign(new x,e[0]),n.preLoadedState=e[1],n.enhancer=e[2]),n},t.prototype.getAppName=function(t){return t||(Object.keys(z).length?"default_"+ ++q:"default")},t.prototype.registerComponents=function(t){for(var e=0,n=Object.values(t);e<n.length;e++){var r=n[e],o=R.getInfo(r),i=this.getTypeWarehouse(o.originalClass),a=o.id||_.nextAvailableId();i.set(a,r)}},t.prototype.getTypeWarehouse=function(t){return this.warehouse.has(t)||this.warehouse.set(t,new Map),this.warehouse.get(t)},t.prototype.updateState=function(t){var e=this;return function(){if(!e.initialStateUpdated||!t.invoked){var n=Date.now(),r=e.store.getState();e.updateStateRecursion(e.root,r,new B),e.initialStateUpdated=!0;var o=Date.now();T.debug("[updateState] Component tree updated in "+(o-n)+"ms.")}t.reset()}},t.prototype.updateStateRecursion=function(t,e,n){if(t===e)return e;if(l(t)||l(e))return e;if(n.visited.has(t))return t;n.visited.add(t);var r;return r=Array.isArray(t)&&Array.isArray(e)?this.updateArray(t,e,n):this.updateObject(t,e,n),r&&r.length&&(T.debug("[updateState] Change in '"+n.path+"'. "+r),T.verbose("[updateState] New state: ",t)),t},t.prototype.updateObject=function(t,e,n){for(var r=[],o=0,i=Object.keys(t);o<i.length;o++){var a=i[o];if(!M.isIgnoredProperty(t,a)&&!e.hasOwnProperty(a)){var u=Object.getOwnPropertyDescriptor(t,a);if(u&&"function"==typeof u.get)continue;"function"==typeof t[a]&&T.warn("[updateState] Function property removed in path: "+n.path+"."+a+". Consider using a method instead."),delete t[a],r.push(a)}}for(var s=[],c=0,f=Object.keys(e);c<f.length;c++){var a=f[c];if(!M.isIgnoredProperty(t,a)){var u=Object.getOwnPropertyDescriptor(t,a);if(!u||"function"!=typeof u.get||"function"==typeof u.set){var p=e[a],d=t[a],h=this.updateStateRecursion(d,p,U({},n,{path:n.path+"."+a}));h!==d&&(t[a]=h,s.push(a))}}}if(s.length||r.length){var l=s.length?"Props assigned: "+s.join(", ")+".":"",g=r.length?"Props deleted: "+r.join(", ")+".":"";return l+(s.length&&r.length?" ":"")+g}return null},t.prototype.updateArray=function(t,e,n){for(var r=[],o=t.length,i=e.length,a=[],u=0;u<Math.min(o,i);u++){var s=e[u],c=t[u],f=this.updateStateRecursion(c,s,U({},n,{path:n.path+"."+u}));f!==c&&(t[u]=f,a.push(u))}if(a.length&&r.push("Assigned item(s) at indexes "+a.join(", ")+"."),i>o){var p=e.slice(o);Array.prototype.push.apply(t,p),r.push("Added "+(i-o)+" item(s) at index "+o+".")}else o>i&&(t.splice(i),r.push("Removed "+(o-i)+" item(s) at index "+i+"."));return r.join(" ")},t.options=E,t}(),X=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},G=function(){function t(t){this.visited=new Set,this.path=W,this.componentPaths=[],this.invoked=!1,Object.assign(this,t)}return t.prototype.reset=function(){this.invoked=!1},t}(),H=function(){function t(){}return t.createReducer=function(e,n){var r=L.getInfo(n);if(!r)throw new Error("Inconsistent component '"+n.constructor.name+"'. The 'component' class decorator is missing.");var o=t.createMethodsLookup(n,r),i=R.getInfo(e).id;return function(r,a){if(T.verbose("[reducer] Reducer of: "+n.constructor.name+", action: "+a.type+"."),void 0===r)return T.verbose("[reducer] State is undefined, returning initial value."),t.finalizeStateObject(e);if(r===n)return T.verbose("[reducer] State equals to component's template, returning initial value."),t.finalizeStateObject(e);if(i!==a.id)return T.verbose("[reducer] Component id and action.id don't match ("+i+" !== "+a.id+")."),r;var u=o[a.type];return u?(u.call.apply(u,[e].concat(a.payload)),T.verbose("[reducer] Reducer invoked, returning new state."),t.finalizeStateObject(e)):(T.verbose("[reducer] No matching action in this reducer, returning previous state."),r)}},t.combineReducersTree=function(e,n){var r=t.combineReducersRecursion(e,n);return function(t,e){var o=Date.now();n.invoked=!0,T.debug("[rootReducer] Reducing action: "+e.type+".");var i=r(t,e),a=Date.now();return T.debug("[rootReducer] Reducer tree processed in "+(a-o)+"ms."),i}},t.createMethodsLookup=function(t,e){var n=d(t),r={};return Object.keys(e.actions).forEach(function(e){var o=Y.getActionName(t,e);r[o]=n[e]}),r},t.finalizeStateObject=function(t){T.verbose("[finalizeStateObject] finalizing state.");var e=Object.assign({},t);return e=M.removeIgnoredProps(e,t),T.verbose("[finalizeStateObject] state finalized."),e},t.combineReducersRecursion=function(e,n){if(!l(e)&&!n.visited.has(e)){if(n.visited.add(e),!n.componentPaths.some(function(t){return t.startsWith(n.path)}))return t.identityReducer;var r,o=R.getInfo(e);r=o?o.reducer:t.identityReducer;for(var i={},a=0,s=Object.keys(e);a<s.length;a++){var c=s[a],f=t.combineReducersRecursion(e[c],new G(X({},n,{path:""===n.path?c:n.path+"."+c})));"function"==typeof f&&(i[c]=f)}var p=r;if(Object.keys(i).length){var d=u(i);p=function(e,n){var o=r(e,n),i=d(o,n);return t.mergeState(o,i)}}return p}},t.mergeState=function(t,e){if(Array.isArray(t)&&Array.isArray(e)){for(var n=0;n<e.length;n++)t[n]=e[n];return t}return X({},t,e)},t.identityReducer=function(t){return t},t}(),J=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},K=function(){function t(t){this.visitedNodes=new Set,this.visitedTemplates=new Map,this.path=W,this.createdComponents={},Object.assign(this,t)}return t}(),Q=function(){function t(e,n,r){if(!L.getInfo(n))throw new Error("Argument 'template' is not a component template. Did you forget to use the decorator?");t.createSelf(this,e,n,r),r.createdComponents[r.path]=this,r.visitedTemplates.set(n,this),T.verbose("[Component] New "+n.constructor.name+" component created. Path: "+r.path),t.createSubComponents(this,e,n,r)}return t.create=function(e,n,r){return r=Object.assign(new K,r),L.getOrInitInfo(n),new(t.getComponentClass(n))(e,n,r)},t.getComponentClass=function(e){var n=L.getInfo(e);return n.componentClass||(n.componentClass=t.createComponentClass(e)),n.componentClass},t.createComponentClass=function(e){var n=new Function("initCallback",'"use strict";return function '+e.constructor.name+"_ReduxAppComponent() { initCallback(this, arguments); }"),r=n(function(e,n){return t.apply(e,n)});r.prototype=Object.create(t.prototype),r.prototype.constructor=r;var o=Y.createActions(e);return Object.assign(r.prototype,o),r},t.createSelf=function(t,e,n,r){s(t,n,[N.Field,N.Property]);var o=_.getComponentId(r.parentTemplate,r.path),i=R.initInfo(t,n,e.dispatch,o),a=A.getOrInitInfo(t),u=A.getInfo(n)||new A;a.ignoreState=u.ignoreState,i.reducer=H.createReducer(t,n)},t.createSubComponents=function(e,n,r,o){if(!l(e)&&!o.visitedNodes.has(e)){o.visitedNodes.add(e);for(var i=r||e,a=0,u=Object.keys(i);a<u.length;a++){var s=u[a],c=o.path+"."+s,f=i[s];L.getInfo(f)?o.visitedTemplates.has(f)?e[s]=o.visitedTemplates.get(f):e[s]=t.create(n,f,J({},o,{parentTemplate:r,path:c})):t.createSubComponents(e[s],n,null,J({},o,{parentTemplate:null,path:c}))}}},t}(),Y=function(){function t(){}return t.createActions=function(e){var n=d(e);if(n){var r=L.getInfo(e),o={};return Object.keys(n).forEach(function(i){o[i]=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];if(!(this instanceof Q))throw new Error("Component method invoked with non-Component as 'this'. Component: "+e.constructor.name+", Method: "+i+", Bound 'this' argument is: "+this+".");var u=n[i];if(r.actions[i]||r.sequences[i]){var s=R.getInfo(this),c={type:t.getActionName(e,i),id:s?s.id:void 0,payload:o};s.dispatch(c)}if(!r.actions[i])return u.call.apply(u,[this].concat(o))}}),o}},t.getActionName=function(t,e){var n=t.constructor.name;return(0,E.actionNameResolver)(n,e)},t}();n.d(e,"isInstanceOf",function(){return w}),n.d(e,"action",function(){return g}),n.d(e,"component",function(){return v}),n.d(e,"ignoreState",function(){return y}),n.d(e,"sequence",function(){return b}),n.d(e,"withId",function(){return m}),n.d(e,"AppOptions",function(){return x}),n.d(e,"GlobalOptions",function(){return k}),n.d(e,"LogLevel",function(){return I}),n.d(e,"getMethods",function(){return d}),n.d(e,"ReduxApp",function(){return V})},function(t,e){t.exports=require("redux")}])});